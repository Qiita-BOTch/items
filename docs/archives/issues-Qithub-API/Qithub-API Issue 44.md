これは  リポジトリの[ issue をアーカイブ]()したものです。

# プロセス：「新着Qiita記事トゥート」の親トゥートの CW がおかしい

- 2017/11/05 14:19 by KEINOS
- State: closed
- Archive of https://api.github.com/repos/Qithub-BOT/Qithub-API

## 本文

## バグ報告

cron実行されるデプロイ先から新着Qiita記事トゥート（「#qithub_dev」タグのないトゥート）のうち、トゥートを始める旨の初回アナウンスで「CW」が有効になっていません。

https://qiitadon.com/@qithub/98952177536428625

## 自分の案

https://blog.keinos.com/qithub/index.php?process=toot-daily-qiita-items

上記、新着Qiita記事トゥートのトリガーの直リンを叩くと、未投稿トゥートがある場合エラーもでます。
エラーは「テスト」タグの付いた記事は無視する処理が抜けているっぽい内容なので、デプロイ先で抜けているコミットがあるようです。（要確認です）

以下のコマンドをデプロイ先のディレクトリで実行し、リモートの`master`を「完全上書き」しているハズなのですが、、、もっと確実な上書きコマンドってありますかね？

```
$ git fetch origin
$ git reset --hard origin/master
```

----------------

- [x] 過去の Issues も検索しましたが該当するものはありませんでした。

----------------

## TL;DR（進捗・結論 2017/11/05 現在）

- 審議中 ( ´・ω) (´・ω・) (・ω・｀) (ω・｀ )


-----

## コメント

-----

##### 341978032

2017/11/05 14:41 by hidao80

嫌な予感がします。🤔

origin の参照先 URL は本当に https://github.com/Qithub-BOT/scripts.git ですか？

**ローカルから Push して、origin === ローカルリポジトリ ということはない**ですよね？

そのローカルリポジトリは `$ git pull` or `$ git reset --hard origin/master` されたものですか？

*質問を質問で返す、嫌われる技術者スタイル*

-----

##### 341979646

2017/11/05 15:04 by KEINOS

> origin の参照先 URL は本当に https://github.com/Qithub-BOT/scripts.git ですか？

以下のように確認してみたのですが、合っているっぽいんですよね。

```
-bash-4.2$ git remote -v
origin  https://github.com/Qithub-BOT/scripts.git (fetch)
origin  https://github.com/Qithub-BOT/scripts.git (push)
```

あ、DEV側のファイルでリモートの master にコミットされていないものが、あるの、か？


-----

##### 341980316

2017/11/05 15:12 by hidao80

>あ、DEV側のファイルでリモートの master にコミットされていないものが、あるの、か？

次はその線が怪しいですね。

っていうか、`$ git pull` では上手くいかない？ pull が本筋だと思ってました。

-----

##### 341980627

2017/11/05 15:17 by hidao80

フラッシュアイデアですか、**ローカルのブランチが master でない**可能性はないですか？

-----

##### 341985035

2017/11/05 16:19 by KEINOS

> っていうか、`$ git pull` では上手くいかない？ 

NGでした。

`pull`だと差分変更だけを引っ張ってくるので、（通常はありえませんが）デプロイ側で変更・コミットがあった場合はそれが残ってしまうため、新規で`clone`した状態、つまり**リモート master とまったく同じ状態**にしたいので `--hard`に`reset`しているのですが・・・

と、考えるとやはり**DEV環境にはあって、どこにもコミットされていないファイルがある**可能性が大ですね。チェックしてみます。

-----

##### 341985233

2017/11/05 16:22 by KEINOS

今晩中にやっつけたいので 明日まで 😎 で進めていいですか？

-----

##### 341998364

2017/11/05 19:29 by KEINOS

[#43](https://github.com/Qithub-BOT/scripts/issues/43#issue-271280199) の「 😎 🙏 」と合わせて対応することに 😎 

-----

##### 342004157

2017/11/05 20:47 by hidao80

👍👌😎🙏

-----

##### 342093185

2017/11/06 09:32 by KEINOS

あれ？ちゃんと動いている・・・
https://qiitadon.com/@qithub/98956424559491669
なんぞ？原因がわからんコミットちゃん #明日まで様子見

-----

##### 343359999

2017/11/10 02:51 by KEINOS

PR #47 のDEV環境で正常動作確認。マージ後、修復されている（はず）


-----

##### 343364239

2017/11/10 03:23 by hidao80

👍

-----

##### 343506318

2017/11/10 15:39 by KEINOS

デプロイ（本稼働）先で動作確認できたので close し 💪 

https://qiitadon.com/@qithub/98980819319668918

-----

##### 343521589

2017/11/10 16:34 by hidao80

👍👏😄
